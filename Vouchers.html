<!doctype html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>

    <link href="https://cdn.bootcss.com/iview/2.4.0/styles/iview.css" rel="stylesheet">
    <script src="https://cdn.bootcss.com/vue/2.4.4/vue.js"></script>
    <script src="https://cdn.bootcss.com/iview/2.4.0/iview.min.js"></script>
    <script src="https://cdn.bootcss.com/underscore.js/1.8.3/underscore-min.js"></script>
    <script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
    <script src="public/js/layout.js"></script>
    <script src="https://cdn.bootcss.com/es6-promise/4.1.1/es6-promise.auto.js"></script>
    <script src="https://cdn.bootcss.com/es6-promise/4.1.1/es6-promise.auto.min.js"></script>
    <script src="https://cdn.bootcss.com/html2canvas/0.5.0-beta4/html2canvas.min.js"></script>
    <script src="https://cdn.bootcss.com/jspdf/1.3.5/jspdf.min.js"></script>
    <link rel="stylesheet" href="public/css/app.css">

</head>
<body>


<!--职信链，样式头为 c (chain小写) 例

头部 c-header
底部 c-footer
组件 c-component-组件名（公用部分）

无特别意义的逻辑结构以 相对有意义模块名 后，层级数字标识
例： c-component-组件名 下

组件名1>组件名1-1.

或

组件名-head>组件名-head-top>（组件名-head-top-1+组件名-head-top-2+组件名-head-top-3）

 -->

<div class="wrap" id="app" @click="closeModal">
    <div class="c-header">
        <div class="c-head-logo">
            <img src="public/images/logo.png" width="334" alt="职信链LOGO">
        </div>
        <div class="c-head-menu">
            <ul class="head-menu-ul">
                <li>
                    <span>购买</span>
                </li>
                <li>

                    <dropdown trigger="custom" :visible="visible" style="margin-left: 20px">
                        <a href="javascript:void(0)" @click.stop="handleOpen()">
                            青岛高新技术产业孵化中心
                            <icon type="arrow-down-b"></icon>
                        </a>
                        <dropdown-menu slot="list">
                            <div class="head-menu-userInfo">
                                <div class="clearFix head-menu-u1">
                                    <span class="left h-m-u-1">支持员工数量</span>
                                    <span class="right">40</span>
                                </div>
                                <div class="clearFix head-menu-u2">
                                    <span class="left h-m-u-1">有效期至</span>
                                    <span class="right">2018.11.19</span>
                                </div>
                                <div class="line head-menu-uline"></div>
                                <div class="clearFix head-menu-u3">
                                    <span class="left">
                                        <badge dot>
                                            <a href="#" class="head-message-badge">我的优惠券</a>
                                        </badge>
                                    </span>
                                    <span class="right">
                                        <a href="#" class="head-message-badge">
                                            <Icon type="android-exit"></Icon>
                                            <span>退出</span>
                                        </a>
                                    </span>
                                </div>
                            </div>
                        </dropdown-menu>
                    </dropdown>
                </li>
                <li>
                    <span>职信在线搜索</span>
                </li>
                <li>
                    <div>
                        <!--badge count代表消息数 默认99封顶-->
                        <badge count="1">
                            <a href="#" class="head-message-badge"><img src="public/images/head-mail.png" width="26" alt="消息(0)"></a>
                        </badge>
                    </div>
                </li>
            </ul>
        </div>
    </div>
    <div class="c-body">

        <div class="c-component-vouchers">
            <div class="vouchers-1">
                <span class="vouchers-1-txtBigger">优惠券</span>
                <span>/ Vouchers</span>
            </div>
            <div class="vouchers-2">
                <span>您可以将优惠券发给其他企业，他人可用优惠券支付职信平台的服务费用。<span class="vouchers-2-red">强烈建议您下载全部优惠券图片并妥善保管</span></span>
            </div>
            <!--优惠券不为空时 -->
            <div class="vouchers-3" id="vouchers-have">
                <div class="vouchers-3-1">
                    <div class="vouchers-3-1" style="
    width: 780px;
    margin: 0 auto;
    text-align:left;
">
                        <div class="vouchers-3-1-1" id="vouchers1"><p class="daijq-F1">
                        优惠券码
                        <span class="daijq-F1-blueTxt">AX901</span></p> <p class="daijq-F2">
                        有效期至：2017-12-31
                    </p></div><div class="vouchers-3-1-1"><p class="daijq-F1">
                        优惠券码
                        <span class="daijq-F1-blueTxt">AX901</span></p> <p class="daijq-F2">
                        有效期至：2017-12-31
                    </p></div><div class="vouchers-3-1-1"><p class="daijq-F1">
                        优惠券码
                        <span class="daijq-F1-blueTxt">AX901</span></p> <p class="daijq-F2">
                        有效期至：2017-12-31
                    </p></div><div class="vouchers-3-1-1"><p class="daijq-F1">
                        优惠券码
                        <span class="daijq-F1-blueTxt">AX901</span></p> <p class="daijq-F2">
                        有效期至：2017-12-31
                    </p></div> </div>
                </div>

                <!--图片下载按钮-->


                <div id="ieSaveImgTip" style="
                display: none;
                text-align: center;
                margin-top: 60px;
                margin-bottom: -80px;
                font-size: 12px;">当前浏览器环境不支持保存图片功能，请手动保存优惠码。</div>
                <div class="vouchers-3-2 download-imgAll" style="cursor: pointer;" @click="downloadImageAll">下载全部优惠券图片</div>
            </div>
            <!--优惠券为空时 -->
            <div class="vouchers-3" id="vouchers-empty" style="display: block">
                <div class="vouchers-3-no">
                    <img src="public/images/djq-empty.png">
                </div>
            </div>
        </div>
    </div>
</div>

<script>

//    function SaveAs5(imgURL)
//    {
//        var oPop = window.open(imgURL,"Image","width=0, height=0, top=5000, left=5000");
//        for(; oPop.document.readyState != "complete"; )
//        {
//            if (oPop.document.readyState == "complete")break;
//        }
//        oPop.document.execCommand("SaveAs");
//        oPop.close();
//    }
//
//    function oDownLoad(url) {
//        myBrowser();
//        if (myBrowser()==="IE"||myBrowser()==="Edge"){
//            //IE
//            odownLoad.href="#";
//            var oImg=document.createElement("img");
//            oImg.src=url;
//            oImg.id="downImg";
//            var odown=document.getElementById("down");
//            odown.appendChild(oImg);
//            SaveAs5(document.getElementById('downImg').src)
//        }else{
//            //!IE
//            odownLoad.href=url;
//            odownLoad.download="";
//        }
//    }

var isSupportDownload = 'download' in document.createElement('a');
if(!isSupportDownload){
    $('#ieSaveImgTip').show();
//    SaveAs5()

}

    var Main = {
        data :function() {
            return {
                visible: false
            }
        },
        methods: {
            handleOpen :function() {
                this.visible = !this.visible;
            },
            closeModal:function(){
                this.visible = false;
            },
            downloadImageAll:function(){



                var imgs = $('.vouchers-3-1-1');
                for(var imgData in imgs){
                    if(!isSupportDownload) {
                        $('#ieSaveImgTip').show();
//

                        var imgs = $('.vouchers-3-1-1');
                        for (var imgData in imgs) {
                            html2canvas(imgs[imgData],
                                {
                                    onrendered: function (canvas) {

                                        var img = document.createElement('img');
                                        img.src = canvas.toDataURL("image/png");
                                        img.id="downImg";
                                        var doc = new jsPDF();
                                        doc.addImage(img,'png',0,0,0,0);
                                        doc.save(Date.now()+'.pdf')
                                    }
                                }
                            );
                        }
                    }else {

//                        当前浏览器环境不支持保存图片功能，请手动保存优惠码。
                        html2canvas(imgs[imgData],
                            {
                                onrendered: function (canvas) {
                                    var a = document.createElement('a');
                                    // toDataURL defaults to png, so we need to request a jpeg, then convert for file download.
                                    a.href = canvas.toDataURL("image/png");
                                    console.log(a.href)
                                    a.download = 'filename-'+Date.now()+'.png';
                                    a.onclick=function click(){}
                                    a.click();
                                }
                            }
                        );
                    }

                }
            }
        }
    }
    var Component = Vue.extend(Main)
    new Component().$mount('#app')
</script>


</body>
</html>